<div>
  <table border=1 cellspacing=0 cellpadding=3 style="max-width: 250px;">
    <thead>
      <tr><th>shelf</th><th>items</th><tr>
    </thead>
    <tbody>
      {{#each shelves.results as res}}
        <tr>
          <td>
            <!-- clickable tree of shelves -->
            {{#each [...locationMap.get(res.loc)] as loc, idx}}
              <div class="shelflink">
                <a href="/#/shelf/{{loc.link}}">{{loc.name}}</a>{{#if (idx != [...locationMap.get(res.loc)].length - 1) }}.{{/if}}
              </div>
            {{/each}}
          </td>
          <td>{{res.tags}}</td>
        </tr>
      {{/each}}
    </tbody>
  </table>
</div>
<script>
  import SvelteRouter from 'svelte-router'
  export default {
    props: ['shelves'],
    computed: {
      locationMap: shelves => {
        let m = new Map
        for (const shelf of shelves.results) {
          let l = new Set
          let locs = shelf.loc.split('.')
          for (let i=0;i < locs.length;i++) {
            l.add({
              link: `${locs.slice(0,i+1).join('.')}`,
              name: locs[i]
            })
          }
          m.set(shelf.loc, l)
        }
        return m // Svelte doesnt support Set or Map iterators, so use spread
      }
    }
  }
</script>
<style>
  a {
      text-decoration: none;
      color: #840;
  }
  .shelflink {
      display: inline-block;
      white-space: nowrap;
  }
  .shelflink div {
      display: inline-block;
  }
  .shelflink div:hover > a {
      background-color: #fa5;
      color: black;
  }
  a:hover {
      background-color: #fa5;
      color: black;
  }
  td {
      padding: 2px;
      padding-left: 5px;
      padding-right: 3px;
      border-top: none;
      border-left: none;
      white-space: nowrap;
      font-size: 11px;
  }
  th {
      background-color: #ccc;
      border-top: none;
      border-left: none;
      font-size: 12px;
  }
</style>