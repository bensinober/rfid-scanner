<div class="container">
  <div class="shelf-list"><ShelfList shelves="{{ shelves }}" :locationMap /></div>
  {{#if path.shelfId}}
    {{path.shelfId}}
    <div class="shelf-content"><ShelfContent :shelf :locationMap /></div>
  {{/if}}
</div>

<script>
  import SvelteRouter from 'svelte-router'
  import { mockShelves, mockShelfById } from '../assets/mockAPI.js'
  import ShelfList from '../components/ShelfList.html'
  import ShelfContent from '../components/ShelfContent.html'
  const { createRouter } = SvelteRouter
  export default {
    data: () => ({
      shelves: {},
      shelf: {},
      locationMap: null
    }),
    components: {
      ShelfList,
      ShelfContent
    },
    oncreate () {
      // get shelves from api
      // todo: move to helper function
      return new Promise((resolve) => {
        let m = new Map
        for (const shelf of mockShelves.results) {
          let l = new Set
          let locs = shelf.loc.split('.')
          for (let i=0;i < locs.length;i++) {
            l.add({
              link: `${locs.slice(0,i+1).join('.')}`,
              name: locs[i]
            })
          }
          m.set(shelf.loc, l)
        }
        resolve (m) // Svelte doesnt support Set or Map iterators, so use spread
      })
      .then(lmap => {
        this.set({
          locationMap: lmap,
          shelves: mockShelves,
          shelf: mockShelfById
        })
      })
    }
  }
</script>
<style type="text/css">
  .container{
    width: 100%;
  }

  .shelf-list {
    float: left;
    width: 25%;
  }
  .shelf-content {
    float: right;
    width: 75%;
  }
</style>